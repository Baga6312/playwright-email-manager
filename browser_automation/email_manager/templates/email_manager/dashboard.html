<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --dark: #212529;
            --light: #f8f9fa;
        }
        
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f5f7fb; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .card { background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background-color: #f8fafc; font-weight: 600; }
        .status-connected { color: #2ecc71; }
        .status-disconnected { color: #e74c3c; }
        .btn { padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer; font-weight: 500; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .alert-success { background-color: var(--success); color: white; padding: 10px; border-radius: 4px; margin-bottom: 15px; }
        .alert-error { background-color: var(--danger); color: white; padding: 10px; border-radius: 4px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Welcome, {{ request.user.username }}!</h1>
        <a href="{% url 'logout' %}" class="btn btn-primary">Logout</a>
    </div>

    <!-- Messages Block Added Here -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="card">
        <h2>User Management</h2>
        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Proxy</th>
                    <th>Status</th>
                    <th>Profile</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.proxy_address|default:"None" }}</td>
                    <td class="{% if user.is_connected %}status-connected{% else %}status-disconnected{% endif %}">
                        {% if user.is_connected %}Connected{% else %}Disconnected{% endif %}
                    </td>
                    <td>{{ user.is_active_profile|yesno:"Active,Inactive" }}</td>
                <td>
<a href="{% url 'edit_user' user.id %}" class="btn btn-primary">Edit</a>
<form method="post" action="{% url 'delete_user' user.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user?')">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Delete</button>
</form>
</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">No users found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div style="margin-top: 20px;">
<button class="btn btn-primary" onclick="toggleAddUserForm()" id="addUserBtn">Add New User</button>
<a href="{% url 'bulk_import' %}" class="btn btn-primary">Bulk Import (CSV)</a>

<!-- Add User Form (initially hidden) -->
<div id="addUserForm" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
    <h3>Add New User</h3>
    <form method="post" action="{% url 'dashboard' %}">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_user">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div>
                <label>Username (required):</label>
                <input type="text" name="username" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div>
                <label>Email (required):</label>
                <input type="email" name="email" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div>
                <label>Proxy Address:</label>
                <input type="text" name="proxy_address" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div>
                <label>Password:</label>
                <input type="password" name="temp_password" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
        </div>
        <div style="margin-bottom: 15px;">
            <label style="margin-right: 20px;">
                <input type="checkbox" name="is_connected"> Is Connected
            </label>
            <label>
                <input type="checkbox" name="is_active_profile"> Is Active Profile
            </label>
        </div>
        <button type="submit" class="btn btn-primary">Create User</button>
        <button type="button" class="btn" style="background: #6c757d; color: white; margin-left: 10px;" onclick="toggleAddUserForm()">Cancel</button>
    </form>
</div>
</div>
    </div>
    <script>
function toggleAddUserForm() {
    const form = document.getElementById('addUserForm');
    const btn = document.getElementById('addUserBtn');
    
    if (form.style.display === 'none') {
        form.style.display = 'block';
        btn.textContent = 'Hide Form';
    } else {
        form.style.display = 'none';
        btn.textContent = 'Add New User';
        // Clear form
        form.querySelector('form').reset();
    }
}
</script>

</body>
</html>